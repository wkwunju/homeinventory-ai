'use client'

import { createContext, useContext, useState, useEffect, ReactNode, createElement } from 'react'

export type Language = 'zh' | 'en'

const translations = {
  zh: {
    common: {
      loading: '加载中...',
      save: '保存',
      cancel: '取消',
      delete: '删除',
      edit: '编辑',
      add: '添加',
      back: '返回',
      confirm: '确认',
      search: '搜索',
      filter: '筛选',
      clear: '清除',
      submit: '提交',
      close: '关闭',
      yes: '是',
      no: '否',
      ok: '确定',
      error: '错误',
      success: '成功',
      warning: '警告',
      info: '信息',
      optional: '可选',
      understand: '知道了'
    },
    navigation: {
      home: '首页',
      addItem: '添加物品',
      addSpace: '添加空间',
      settings: '设置',
      logout: '退出登录',
      login: '登录',
      register: '注册'
    },
    home: {
      title: '家庭储物管理',
      manageSpaces: '管理空间',
      manageItems: '管理物品',
      mySpaces: '我的空间',
      myItems: '我的物品',
      addSpaceCTA: '添加空间',
      addItemCTA: '添加物品',
      searchPlaceholder: '搜索空间或物品...',
      noSpaces: '暂无空间',
      noItems: '暂无物品',
      createFirstSpace: '创建第一个空间',
      createFirstItem: '添加第一个物品',
      summary: '今天的家当清单：共有 {items} 件物品，分布在 {rooms} 个房间里，估算总价值约 ¥{worth}。',
      summaryMore: '另外，接下来一周有 {soon} 件物品可能到期，已过期的有 {expired} 件，别忘了优先处理哦。',
      itemsCount: '{count} 件物品',
      quantity: '数量',
      location: '位置',
      unspecified: '未指定',
      expire: '过期',
      viewDetail: '查看详情',
      searchResults: '搜索结果',
      clearSearch: '清除搜索',
      spacesSection: '空间 ({count})',
      itemsSection: '物品 ({count})',
      noSearchResultsTitle: '未找到相关结果',
      noSearchResultsHint: '尝试使用不同的关键词搜索',
      spaceManage: '空间管理',
      goManage: '前往管理',
      addModalTitle: '选择添加方式',
      addModalDesc: '请选择手动添加或使用 AI 识别添加物品',
      addModalAI: 'AI 识别添加',
      addModalManual: '手动添加',
      itemsLabel: '物品',
      totalWorthLabel: '总价值'
    },
    settings: {
      title: '设置',
      language: '语言',
      languageDesc: '选择应用显示语言',
      chinese: '中文',
      english: 'English',
      account: '账户',
      profile: '个人资料',
      preferences: '偏好设置',
      notifications: '通知设置',
      notificationsDesc: '管理推送通知',
      privacy: '隐私设置',
      privacyDesc: '管理数据隐私',
      about: '关于',
      aboutApp: '关于应用',
      version: '版本'
    },
    auth: {
      login: '登录',
      register: '注册',
      logout: '退出登录',
      email: '邮箱',
      password: '密码',
      confirmPassword: '确认密码',
      forgotPassword: '忘记密码',
      loginSuccess: '登录成功',
      registerSuccess: '注册成功',
      logoutSuccess: '已退出登录',
      loginFailed: '登录失败',
      registerFailed: '注册失败',
      emailRequired: '请输入邮箱',
      passwordRequired: '请输入密码',
      passwordMismatch: '两次密码不一致',
      invalidEmail: '邮箱格式不正确',
      weakPassword: '密码强度不够',
      loginTitle: '欢迎回来',
      loginSubtitle: '登录以管理你的家庭物品',
      registerTitle: '注册',
      emailPlaceholder: '请输入邮箱地址',
      passwordPlaceholder: '请输入密码',
      passwordMin: '请输入密码（至少6位）',
      haveAccount: '已有账号？',
      noAccount: '还没有账号？',
      goLogin: '立即登录',
      goRegister: '立即注册'
    },
    add: {
      title: '添加物品',
      selectRoom: '选择房间',
      selectLocation: '选择位置',
      selectLocationForRoom: '为 {room} 选择位置',
      addItemsToLocation: '向 {location} 添加物品',
      addItems: '添加物品',
      spaceSelection: '空间选择',
      noRooms: '还没有创建房间',
      createFirstRoom: '创建第一个房间',
      noLocations: '这个房间还没有位置',
      addLocation: '添加位置',
      selectRoomFirst: '请先选择房间',
      selectLocationFirst: '请先选择位置',
      itemNumber: '物品 {number}',
      itemName: '物品名称',
      itemNamePlaceholder: '如：苹果、洗发水',
      quantity: '数量',
      category: '分类',
      categoryPlaceholder: '如：食品、日用品',
      expireDate: '过期日期',
      value: '价值',
      valuePlaceholder: '如：99.99',
      brand: '品牌',
      brandPlaceholder: '如：苹果、海飞丝',
      purchaseDate: '购买日期',
      purchaseSource: '购买来源',
      purchaseSourcePlaceholder: '如：淘宝、实体店',
      condition: '状态',
      selectCondition: '选择状态',
      conditionNew: '全新',
      conditionLikeNew: '九成新',
      conditionGood: '良好',
      conditionFair: '一般',
      conditionPoor: '较差',
      priority: '优先级',
      priorityLow: '低',
      priorityNormal: '普通',
      priorityHigh: '高',
      priorityUrgent: '紧急',
      notes: '备注',
      notesPlaceholder: '添加备注信息...',
      itemImage: '物品图片',
      clickUploadImage: '点击上传图片',
      imageSupport: '支持 JPG、PNG 格式，最大 5MB',
      addMoreItems: '添加更多物品',
      addItemsCount: '添加 {count} 个物品',
      selectLocationAlert: '请选择存放位置',
      addAtLeastOneItem: '请至少添加一个物品',
      addValidItem: '请至少添加一个有效的物品',
      addFailed: '添加失败: {count} 个物品添加失败',
      addSuccess: '成功添加 {count} 个物品',
      addError: '添加物品失败'
    },
    // Added upload translations
    upload: {
      title: '智能上传',
      description: '上传或拍照，自动识别物品并快速添加到清单',
      dragAndDrop: '拖放图片到这里，或选择文件',
      supportedFormats: '支持 JPG、PNG，最大 5MB',
      selectFile: '选择文件',
      takePhoto: '拍照',
      fileSelected: '已选择文件',
      changeFile: '更换文件',
      uploading: '正在上传...',
      uploadNow: '立即上传',
      howItWorks: '使用说明',
      step1Title: '选择或拍摄照片',
      step1Description: '从相册选择或使用相机拍摄包含物品的清晰照片',
      step2Title: 'AI 自动识别',
      step2Description: '系统将识别图片中的物品并生成建议',
      step3Title: '确认并保存',
      step3Description: '检查识别结果，必要时编辑后保存到空间',
      cameraNotSupported: '暂不支持相机',
      cameraNotSupportedDescription: '当前设备或浏览器不支持直接调用相机，请改用上传图片'
    },
    share: {
      button: '分享',
      modalTitle: '分享我的清单',
      modalText: '我在 MaisonStock 有 {items} 件物品，总价值约 ¥{worth}。来看看你的吧！',
      saveImage: '保存图片',
      shareWebsite: '分享网站',
      cancel: '取消'
    },
    welcome: {
      heroTitle: '用 AI 管理你的家庭物品',
      heroSubtitle: '拍一张照片，自动识别、归类与记录。简单、准确、好用。',
      ctaStart: '免费开始',
      ctaHave: '已有账号',
      subtext: '无需信用卡 · 支持手机与桌面端 · 随时退出',
      step1: '拍照上传',
      step1Desc: '对准冰箱/书架/储物盒，轻松拍一张',
      step2: '一键识别',
      step2Desc: 'AI 自动识别名称、数量、分类与建议',
      step3: '轻松管理',
      step3Desc: '随时查看，支持过期提醒与空间管理'
    },
    landing: {
      hero: '轻松管理家当！',
      disastersTitle: '意外总会发生',
      disastersDesc: '火灾、洪水等意外来临时，拥有一份最新的家庭清单能帮助你更快完成保险理赔。数据云端备份，不怕手机丢失。',
      orgTitle: '智能归类',
      orgDesc: '按照房间、位置与子位置管理，就像你的家本来就那样。',
      addTitle: '添加更轻松',
      addDesc: '拍照后自动识别，补充信息即可保存，继续下一件。',
      shareTitle: '分享与协作',
      shareDesc: '邀请家人共享管理，或通过只读链接分享给他人查看。',
      ctaPrimary: '开始添加',
      ctaSecondary: '了解更多'
    },
    spaces: {
      addTitle: '添加空间',
      selectOrCreateRoom: '选择或创建房间',
      addLocationForRoom: '为 {room} 添加具体位置',
      selectRoom: '选择房间',
      selectLocation: '选择位置',
      selectLocationForRoom: '为 {room} 选择具体位置',
      createCustomRoom: '或创建自定义房间',
      roomName: '房间名称',
      roomNamePlaceholder: '如：游戏室、健身房',
      roomIcon: '房间图标',
      selectIcon: '选择图标',
      clickToSelectIcon: '点击选择图标',
      description: '描述',
      roomDescriptionPlaceholder: '房间用途描述...',
      createRoom: '创建房间',
      createCustomLocation: '或创建自定义位置',
      locationName: '位置名称',
      locationNamePlaceholder: '如：床头柜、电视柜',
      locationIcon: '位置图标',
      locationDescriptionPlaceholder: '位置用途描述...',
      createLocation: '创建位置'
    },
    spacesPage: {
      loading: '加载中...',
      room: '房间',
      location: '位置',
      back: '返回',
      roomNotFound: '房间不存在',
      roomDeleted: '房间删除成功',
      locations: '位置列表',
      addLocation: '添加位置',
      noLocations: '暂无位置',
      addFirstLocation: '添加第一个位置',
      viewAllItems: '查看所有物品',
      showAllItems: '显示房间内所有位置的物品',
      itemsTitleRoom: '房间内所有物品',
      itemsTitleLoc: '{name}的物品',
      noItems: '暂无物品',
      addItem: '添加物品',
      edit: '编辑',
      delete: '删除'
    },
    itemPage: {
      editItem: '编辑物品',
      name: '物品名称',
      quantity: '数量',
      category: '分类',
      expireDate: '过期日期',
      value: '价值（元）',
      brand: '品牌',
      purchaseDate: '购买日期',
      purchaseSource: '购入来源',
      condition: '状态',
      priority: '优先级',
      notes: '备注',
      currentLocation: '当前位置',
      save: '保存',
      deleting: '删除'
    }
  },
  en: {
    common: {
      loading: 'Loading...',
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      edit: 'Edit',
      add: 'Add',
      back: 'Back',
      confirm: 'Confirm',
      search: 'Search',
      filter: 'Filter',
      clear: 'Clear',
      submit: 'Submit',
      close: 'Close',
      yes: 'Yes',
      no: 'No',
      ok: 'OK',
      error: 'Error',
      success: 'Success',
      warning: 'Warning',
      info: 'Info',
      optional: 'Optional',
      understand: 'Got it'
    },
    navigation: {
      home: 'Home',
      addItem: 'Add Item',
      addSpace: 'Add Space',
      settings: 'Settings',
      logout: 'Logout',
      login: 'Login',
      register: 'Register'
    },
    home: {
      title: 'Home Inventory',
      manageSpaces: 'Manage Spaces',
      manageItems: 'Manage Items',
      mySpaces: 'My Spaces',
      myItems: 'My Items',
      addSpaceCTA: 'Add Space',
      addItemCTA: 'Add Item',
      searchPlaceholder: 'Search spaces or items...',
      noSpaces: 'No spaces created yet',
      noItems: 'No items added yet',
      createFirstSpace: 'Create first space',
      createFirstItem: 'Add first item',
      summary: 'Today: {items} items across {rooms} rooms. Estimated total worth ¥{worth}.',
      summaryMore: 'Next 7 days: {soon} may expire; {expired} already expired.',
      itemsCount: '{count} items',
      quantity: 'Qty',
      location: 'Location',
      unspecified: 'Unspecified',
      expire: 'Expire',
      viewDetail: 'View details',
      searchResults: 'Search results',
      clearSearch: 'Clear search',
      spacesSection: 'Spaces ({count})',
      itemsSection: 'Items ({count})',
      noSearchResultsTitle: 'No results',
      noSearchResultsHint: 'Try different keywords',
      spaceManage: 'Space Management',
      goManage: 'Go manage',
      addModalTitle: 'Select add method',
      addModalDesc: 'Choose manual add or use AI to add items',
      addModalAI: 'AI Add',
      addModalManual: 'Manual Add',
      itemsLabel: 'Items',
      totalWorthLabel: 'Total Worth'
    },
    settings: {
      title: 'Settings',
      language: 'Language',
      languageDesc: 'Choose app display language',
      chinese: '中文',
      english: 'English',
      account: 'Account',
      profile: 'Profile',
      preferences: 'Preferences',
      notifications: 'Notifications',
      notificationsDesc: 'Manage push notifications',
      privacy: 'Privacy',
      privacyDesc: 'Manage data privacy',
      about: 'About',
      aboutApp: 'About App',
      version: 'Version'
    },
    auth: {
      login: 'Login',
      register: 'Register',
      logout: 'Logout',
      email: 'Email',
      password: 'Password',
      confirmPassword: 'Confirm Password',
      forgotPassword: 'Forgot Password',
      loginSuccess: 'Login successful',
      registerSuccess: 'Registration successful',
      logoutSuccess: 'Logged out successfully',
      loginFailed: 'Login failed',
      registerFailed: 'Registration failed',
      emailRequired: 'Email is required',
      passwordRequired: 'Password is required',
      passwordMismatch: 'Passwords do not match',
      invalidEmail: 'Invalid email format',
      weakPassword: 'Password is too weak',
      loginTitle: 'Welcome back',
      loginSubtitle: 'Sign in to manage your home items',
      registerTitle: 'Register',
      emailPlaceholder: 'Enter your email',
      passwordPlaceholder: 'Enter your password',
      passwordMin: 'Enter a password (at least 6 characters)',
      haveAccount: 'Already have an account?',
      noAccount: "Don't have an account?",
      goLogin: 'Sign in',
      goRegister: 'Sign up'
    },
    add: {
      title: 'Add Items',
      selectRoom: 'Select Room',
      selectLocation: 'Select Location',
      selectLocationForRoom: 'Select location for {room}',
      addItemsToLocation: 'Add items to {location}',
      addItems: 'Add Items',
      spaceSelection: 'Space Selection',
      noRooms: 'No rooms created yet',
      createFirstRoom: 'Create first room',
      noLocations: 'No locations in this room',
      addLocation: 'Add location',
      selectRoomFirst: 'Please select a room first',
      selectLocationFirst: 'Please select a location first',
      itemNumber: 'Item {number}',
      itemName: 'Item Name',
      itemNamePlaceholder: 'e.g., Apple, Shampoo',
      quantity: 'Quantity',
      category: 'Category',
      categoryPlaceholder: 'e.g., Food, Daily Use',
      expireDate: 'Expire Date',
      value: 'Value',
      valuePlaceholder: 'e.g., 99.99',
      brand: 'Brand',
      brandPlaceholder: 'e.g., Apple, Head & Shoulders',
      purchaseDate: 'Purchase Date',
      purchaseSource: 'Purchase Source',
      purchaseSourcePlaceholder: 'e.g., Taobao, Store',
      condition: 'Condition',
      selectCondition: 'Select condition',
      conditionNew: 'New',
      conditionLikeNew: 'Like New',
      conditionGood: 'Good',
      conditionFair: 'Fair',
      conditionPoor: 'Poor',
      priority: 'Priority',
      priorityLow: 'Low',
      priorityNormal: 'Normal',
      priorityHigh: 'High',
      priorityUrgent: 'Urgent',
      notes: 'Notes',
      notesPlaceholder: 'Add notes...',
      itemImage: 'Item Image',
      clickUploadImage: 'Click to upload image',
      imageSupport: 'Supports JPG, PNG format, max 5MB',
      addMoreItems: 'Add More Items',
      addItemsCount: 'Add {count} items',
      selectLocationAlert: 'Please select a location',
      addAtLeastOneItem: 'Please add at least one item',
      addValidItem: 'Please add at least one valid item',
      addFailed: 'Add failed: {count} items failed to add',
      addSuccess: 'Successfully added {count} items',
      addError: 'Failed to add items'
    },
    // Added upload translations
    upload: {
      title: 'Smart Upload',
      description: 'Upload or take a photo, let AI recognize items, and add them quickly',
      dragAndDrop: 'Drag and drop an image here, or choose a file',
      supportedFormats: 'Supports JPG, PNG up to 5MB',
      selectFile: 'Choose File',
      takePhoto: 'Take Photo',
      fileSelected: 'File Selected',
      changeFile: 'Change File',
      uploading: 'Uploading...',
      uploadNow: 'Upload Now',
      howItWorks: 'How it works',
      step1Title: 'Choose or take a photo',
      step1Description: 'Pick from gallery or take a clear photo with the items',
      step2Title: 'AI recognition',
      step2Description: 'We detect items in the image and generate suggestions',
      step3Title: 'Review and save',
      step3Description: 'Check results, edit if needed, then save to a space',
      cameraNotSupported: 'Camera not supported',
      cameraNotSupportedDescription: 'Your device or browser does not support camera access. Please upload an image instead.'
    },
    share: {
      button: 'Share',
      modalTitle: 'Share my list',
      modalText: 'I have {items} items in MaisonStock, worth about ¥{worth}. Check yours!',
      saveImage: 'Save Image',
      shareWebsite: 'Share Website',
      cancel: 'Cancel'
    },
    welcome: {
      heroTitle: 'Manage your home items with AI',
      heroSubtitle: 'Snap a photo, auto-recognize, categorize, and record. Simple and accurate.',
      ctaStart: 'Get Started Free',
      ctaHave: 'I already have an account',
      subtext: 'No credit card · Mobile & desktop · Leave anytime',
      step1: 'Snap & Upload',
      step1Desc: 'Point at your fridge/bookshelf/box and snap',
      step2: 'One-tap Recognition',
      step2Desc: 'AI detects name, count, category and suggestions',
      step3: 'Easy Management',
      step3Desc: 'View anytime, expiry reminders and location management'
    },
    landing: {
      hero: 'Home inventory made easy!',
      disastersTitle: 'Disasters happen',
      disastersDesc: 'Fires, floods, storms. A current inventory helps settle insurance claims faster. Everything is backed up to the cloud.',
      orgTitle: 'Smart organization',
      orgDesc: 'Organized by Room, Storage and Sub-storage — just like your home.',
      addTitle: 'Adding is a breeze',
      addDesc: 'Snap, add details, save, and you are ready for the next item.',
      shareTitle: 'Share & collaborate',
      shareDesc: 'Invite housemates to edit, or share a read‑only public link.',
      ctaPrimary: 'Start adding',
      ctaSecondary: 'Learn more'
    },
    spaces: {
      addTitle: 'Add Space',
      selectOrCreateRoom: 'Select or Create Room',
      addLocationForRoom: 'Add specific location for {room}',
      selectRoom: 'Select Room',
      selectLocation: 'Select Location',
      selectLocationForRoom: 'Select specific location for {room}',
      createCustomRoom: 'or Create Custom Room',
      roomName: 'Room Name',
      roomNamePlaceholder: 'e.g., Game Room, Gym',
      roomIcon: 'Room Icon',
      selectIcon: 'Select Icon',
      clickToSelectIcon: 'Click to select icon',
      description: 'Description',
      roomDescriptionPlaceholder: 'Room description...',
      createRoom: 'Create Room',
      createCustomLocation: 'or Create Custom Location',
      locationName: 'Location Name',
      locationNamePlaceholder: 'e.g., Nightstand, TV Stand',
      locationIcon: 'Location Icon',
      locationDescriptionPlaceholder: 'Location description...',
      createLocation: 'Create Location'
    },
    spacesPage: {
      loading: 'Loading...',
      room: 'Room',
      location: 'Location',
      back: 'Back',
      roomNotFound: 'Room not found',
      roomDeleted: 'Room deleted',
      locations: 'Locations',
      addLocation: 'Add Location',
      noLocations: 'No locations yet',
      addFirstLocation: 'Add first location',
      viewAllItems: 'View all items',
      showAllItems: 'Show items in all locations',
      itemsTitleRoom: 'All items in room',
      itemsTitleLoc: 'Items in {name}',
      noItems: 'No items yet',
      addItem: 'Add Item',
      edit: 'Edit',
      delete: 'Delete'
    },
    itemPage: {
      editItem: 'Edit Item',
      name: 'Name',
      quantity: 'Quantity',
      category: 'Category',
      expireDate: 'Expire Date',
      value: 'Value',
      brand: 'Brand',
      purchaseDate: 'Purchase Date',
      purchaseSource: 'Purchase Source',
      condition: 'Condition',
      priority: 'Priority',
      notes: 'Notes',
      currentLocation: 'Current Location',
      save: 'Save',
      deleting: 'Delete'
    }
  }
}

interface LanguageContextType {
  language: Language
  setLanguage: (lang: Language) => void
  t: (key: string, params?: Record<string, any>) => string
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined)

export function LanguageProvider({ children }: { children: ReactNode }) {
  const [language, setLanguageState] = useState<Language>('zh')

  useEffect(() => {
    const savedLanguage = localStorage.getItem('language') as Language
    if (savedLanguage && (savedLanguage === 'zh' || savedLanguage === 'en')) {
      setLanguageState(savedLanguage)
    }
  }, [])

  const setLanguage = (lang: Language) => {
    setLanguageState(lang)
    localStorage.setItem('language', lang)
  }

  const t = (key: string, params?: Record<string, any>): string => {
    const keys = key.split('.')
    let value: any = translations[language]
    
    for (const k of keys) {
      if (value && typeof value === 'object' && k in value) {
        value = value[k]
      } else {
        return key
      }
    }
    
    let result = typeof value === 'string' ? value : key
    
    if (params) {
      Object.keys(params).forEach(param => {
        result = result.replace(new RegExp(`{${param}}`, 'g'), params[param])
      })
    }
    
    return result
  }

  return createElement(LanguageContext.Provider, { value: { language, setLanguage, t } }, children)
}

export function useLanguage() {
  const context = useContext(LanguageContext)
  if (context === undefined) {
    throw new Error('useLanguage must be used within a LanguageProvider')
  }
  return context
} 